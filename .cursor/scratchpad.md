# 大众点评网页元素读取项目规划

## 背景和动机

**项目目标**: 基于现有项目的网页元素读取机制，实现对大众点评网站 (https://g.dianping.com/dzim-main-pc/index.html#/) 的元素读取功能

**技术需求**:
- 基于现有的 "浏览器扩展 + WebSocket通信" 架构
- 优先使用 Python 实现后端处理
- 需要读取大众点评网页的特定元素数据

**业务价值**:
- 实现自动化的网页数据提取
- 建立可扩展的网页监控和数据获取系统

## 关键挑战和分析

### 技术挑战
1. **网站特殊性**: 大众点评是复杂的单页应用(SPA)，包含动态加载内容
2. **反爬虫机制**: 可能存在用户行为检测、请求频率限制等
3. **元素定位**: 需要准确识别目标网页的关键DOM元素
4. **跨域通信**: 浏览器扩展与Python后端的通信机制
5. **实时性**: 需要监听DOM变化并及时响应

### 技术架构分析
基于现有技术文档，采用以下架构：
```
大众点评网页 ←→ 浏览器扩展(Content Script) ←→ WebSocket ←→ Python后端 ←→ 数据处理/存储
```

## 高层任务拆分

### 阶段1: 环境准备和基础架构搭建
- [ ] **任务1.1**: 创建项目目录结构
  - 成功标准: 建立清晰的Python项目结构，包含扩展、后端、测试目录
- [ ] **任务1.2**: 搭建Python WebSocket服务器
  - 成功标准: 能够启动WebSocket服务器并监听连接
- [ ] **任务1.3**: 创建浏览器扩展基础框架
  - 成功标准: 能够在浏览器中加载扩展并注入Content Script

### 阶段2: 网页分析和元素定位
- [ ] **任务2.1**: 分析大众点评网页结构
  - 成功标准: 识别出关键DOM元素的选择器和数据结构
- [ ] **任务2.2**: 实现DOM元素监听机制
  - 成功标准: 能够监听到页面元素变化并捕获数据
- [ ] **任务2.3**: 设计数据提取规则
  - 成功标准: 定义清晰的数据提取和格式化规则

### 阶段3: 通信机制实现
- [ ] **任务3.1**: 实现扩展到WebSocket的数据传输
  - 成功标准: 扩展能够成功连接WebSocket并发送数据
- [ ] **任务3.2**: 实现Python后端数据处理
  - 成功标准: 后端能够接收、解析和处理来自扩展的数据
- [ ] **任务3.3**: 添加错误处理和重连机制
  - 成功标准: 系统能够处理连接断开、重连等异常情况

### 阶段4: 测试和优化
- [ ] **任务4.1**: 单元测试和集成测试
  - 成功标准: 所有核心功能通过测试
- [ ] **任务4.2**: 性能优化和稳定性测试
  - 成功标准: 系统能够稳定运行，处理各种边界情况
- [ ] **任务4.3**: 文档和部署指南
  - 成功标准: 完整的使用文档和部署说明

## 项目状态看板

### 待完成任务
- [ ] 任务2.1: 分析大众点评网页结构
- [ ] 任务2.2: 实现DOM元素监听机制
- [ ] 任务2.3: 设计数据提取规则
- [ ] 任务3.1: 实现扩展到WebSocket的数据传输
- [ ] 任务3.2: 实现Python后端数据处理
- [ ] 任务3.3: 添加错误处理和重连机制
- [ ] 任务4.1: 单元测试和集成测试
- [ ] 任务4.2: 性能优化和稳定性测试
- [ ] 任务4.3: 文档和部署指南

### 进行中任务
- 当前无进行中任务

### 已完成任务
- [x] 任务1.1: 创建项目目录结构 ✅
- [x] 任务1.2: 搭建Python WebSocket服务器 ✅  
- [x] 任务1.3: 创建浏览器扩展基础框架 ✅

## 当前状态/进度跟踪

**项目状态**: 阶段1已完成，浏览器扩展基础框架搭建完成
**当前进度**: 3/12 任务完成 (25.0%)
**下一步行动**: 进入阶段2 - 执行任务2.1 分析大众点评网页结构

## 执行者反馈或请求帮助

**任务1.3完成报告** (执行者):
✅ 成功创建浏览器扩展基础框架:
- 扩展配置: `extension/manifest.json` (Manifest V3配置，支持大众点评域名)
- WebSocket通信: `extension/websocket.js` (完整的WebSocket管理器，支持重连和消息队列)
- 内容脚本: `extension/content.js` (16KB+完整的数据提取器，支持DOM监听和多种页面类型)
- 后台脚本: `extension/background.js` (事件管理、消息传递、数据存储)
- 用户界面: `extension/popup.html/css/js` (现代化弹出窗口，实时状态显示)
- 测试工具: `extension/test_extension.js` (扩展功能自动化测试)
- 安装指南: `extension/INSTALL.md` (完整的安装和测试文档)
- 图标资源: `extension/icons/icon.svg` (SVG格式扩展图标)

**功能验证**:
- ✅ Manifest V3配置正确，支持所有必要权限
- ✅ WebSocket通信模块完整，包含重连机制
- ✅ Content Script包含完整的DOM监听和数据提取逻辑
- ✅ Background Script支持事件管理和数据存储
- ✅ 弹出窗口界面美观，功能完整
- ✅ 扩展测试脚本可以验证基础功能

**成功标准验证**: ✅ 能够在浏览器中加载扩展并注入Content Script

**阶段1总结**: 
- ✅ 项目环境搭建完成 (目录结构、依赖、文档)
- ✅ Python WebSocket后端完成 (服务器、配置、测试)
- ✅ 浏览器扩展框架完成 (所有核心文件、UI、测试)

**准备开始阶段2**: 网页分析和元素定位

## 经验教训

### 技术要点
- 大众点评网站可能使用了复杂的前端框架，需要仔细分析DOM结构
- WebSocket连接需要考虑网络稳定性和重连机制
- 浏览器扩展需要处理不同浏览器的兼容性问题

### 注意事项
- 编辑文件前先读文件
- 程序输出要包含调试信息
- 使用 -force git命令前要先问用户确认
- Windows环境下PowerShell命令不要使用 &&
