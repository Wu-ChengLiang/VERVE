# 联系人批量数据提取功能说明

## 功能概述
这个功能可以自动遍历联系人列表，逐个点击联系人并提取每个联系人的聊天记录和团购信息，实现批量数据采集。

## 使用方法

### 1. 打开扩展popup
- 在大众点评网站上，点击浏览器扩展图标打开控制面板

### 2. 配置参数
在"批量数据提取"面板中设置：
- **联系人数量**: 设置要处理的联系人数量（1-50，默认10）
- **处理间隔**: 设置每个联系人处理的时间间隔（3-10秒，默认8秒）

### 3. 开始批量提取
- 点击"开始批量提取"按钮
- 系统会自动按照以下流程处理每个联系人：
  1. 点击联系人
  2. 等待页面加载（3秒）
  3. 提取聊天记录和团购信息
  4. 等待处理完成（5秒）
  5. 继续下一个联系人
- 进度会实时显示在"进度"栏中，包含当前处理的联系人名称

### 4. 停止操作
- 可以随时点击"停止提取"按钮来终止操作
- 操作完成后会自动停止并显示完成消息

## 技术实现

### 联系人元素识别
系统会查找页面中的联系人元素，选择器为：`.chat-list-item`

### 支持的HTML结构
基于您提供的HTML结构：
```html
<!-- 第一个联系人 -->
<div class="chat-list-item-wrapper" data-chatid="s67959582-m3391452019-2">
    <div class="chat-list-item" id="s67959582-m3391452019-2" data-chatid="s67959582-m3391452019-2">
        <!-- 联系人内容 -->
    </div>
</div>

<!-- 第二个联系人 -->  
<div class="chat-list-item" id="s522381136-u2370326998-2" data-chatid="s522381136-u2370326998-2">
    <!-- 联系人内容 -->
</div>
```

### 处理流程
1. **联系人识别**: 按照页面中联系人元素的出现顺序，从第1个开始处理
2. **点击联系人**: 模拟点击联系人元素，触发页面跳转到对应聊天页面
3. **等待加载**: 等待3秒让页面内容完全加载
4. **数据提取**: 提取当前联系人的聊天记录和团购信息
5. **数据标记**: 为提取的数据添加联系人信息（姓名、ID等）
6. **发送数据**: 将数据发送到后台服务器
7. **继续下一个**: 等待5秒后处理下一个联系人

### 提取的数据类型
- **聊天消息**: 包含客户消息、商家回复等
- **团购信息**: 包含商品名称、价格、图片等
- **联系人信息**: 联系人姓名、聊天ID、处理时间等

## 注意事项

1. **页面兼容性**: 请确保在正确的大众点评聊天页面上使用此功能
2. **网络延迟**: 如果页面加载较慢，建议增加处理间隔（推荐8-10秒）
3. **数量限制**: 最多支持一次处理50个联系人
4. **安全考虑**: 避免设置过短的间隔时间，以免对服务器造成过大压力
5. **数据完整性**: 系统会等待页面完全加载后再提取数据，确保数据完整性
6. **内存使用**: 处理大量联系人时请注意浏览器内存使用情况

## 错误处理

如果遇到以下情况，系统会自动停止并显示错误信息：
- 页面中未找到联系人元素
- 指定序号的联系人不存在
- 点击或数据提取过程中发生异常
- 页面加载超时或失败

## 数据输出格式

提取的数据会包含以下信息：
```json
{
  "type": "chat_message",
  "messageType": "customer", // 或 "shop"
  "content": "[客户] 消息内容",
  "contactInfo": {
    "name": "联系人姓名",
    "chatId": "聊天ID",
    "timestamp": 1234567890
  },
  "contactName": "联系人姓名",
  "contactChatId": "聊天ID"
}
```

## 更新日志

- v2.0.0: 新增批量数据提取功能，集成联系人遍历和数据提取
- v1.0.0: 初始版本，支持基本的联系人自动点击功能 